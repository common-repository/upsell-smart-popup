window.P_USP=window.P_USP||{},function(o){"use strict";const a=o("#usp__modalbox"),t=a.data("modalbox-config"),d="ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0;P_USP.init=function(){void 0!==a&&a.length>0&&(t.misc.is_shop_page&&P_USP.handleShopUpsell(),t.misc.is_product_page&&P_USP.handleProductUpsell(),t.misc.is_cart_page&&a.hasClass("cart__modalbox")&&P_USP.handleCartUpsell(),t.misc.is_checkkout_page&&a.hasClass("checkout__modalbox")&&P_USP.handleCheckoutUpsell())},P_USP.handleProductUpsell=()=>{P_USP.initModalBox(t.modalbox_heading,!0,t.modalbox_delay)},P_USP.handleShopUpsell=()=>{o(document.body).on("added_to_cart",(function(t,d,i,_){let e=o(_).data("product_id");void 0!==e&&""!==e&&o.ajax({type:"post",dataType:"json",url:p_usp_params.ajaxURL,data:{action:"maybe_ajax_request_product_data",_wpnonce:p_usp_params.ajaxNonce,add_to_cart:e},beforeSend:function(){},success:function(o){!0===o.success&&(a.find("#product__wrapper").removeClass(),a.find("#product__wrapper").addClass(o.data.modalbox_class),a.find(".product__photo").html(o.data.product_image),a.find(".product__title").html(o.data.product_title),a.find(".product__price").html(o.data.product_price),a.find(".product__rating").html(o.data.product_ratings),a.find(".product__info_value.categories").html(o.data.product_categories),a.find(".product__info_value.sku").html(o.data.product_sku),a.find(".product__info_value.availability").html(o.data.product_availability),a.find(".product__decription").html(o.data.product_description),a.find(".product__actions").html(o.data.product_addtocart_button),P_USP.initModalBox(o.data.modalbox_heading,!0,o.data.modalbox_delay))},complete:function(){},error:function(o,a,t){}})}))},P_USP.handleCartUpsell=()=>{P_USP.initModalBox(t.modalbox_heading,!0,t.modalbox_delay),o(document.body).on("added_to_cart",(function(a,d,i,_){if(_.hasClass("cart_modalbox_addtocart")){let a=o(_).data("product_id");parseInt(t.product_id)===a&&P_USP.closeDialogBox()}}))},P_USP.handleCheckoutUpsell=()=>{let a=t.misc.checkout_post_codes;""===a&&P_USP.initModalBox(t.modalbox_heading,!0,t.modalbox_delay),void 0!==a&&""!==a&&(a=a.split(/\s*,\s*/),jQuery("body").on("updated_checkout",(function(){a.indexOf(o("#billing_postcode").val())>-1&&P_USP.initModalBox(t.modalbox_heading,!0,t.modalbox_delay)})),o("#billing_postcode").keyup((function(){a.indexOf(o("#billing_postcode").val())>-1&&P_USP.initModalBox(t.modalbox_heading,!0,t.modalbox_delay)}))),o(document.body).on("added_to_cart",(function(a,d,i,_){if(_.hasClass("checkout_modalbox_addtocart")){let a=o(_).data("product_id");parseInt(t.product_id)===a&&(o(document.body).trigger("update_checkout"),P_USP.closeDialogBox())}}))},P_USP.initModalBox=(t,i=!1,_=0)=>{setTimeout((function(){a.dialog({title:t,autoOpen:i,resizable:!1,draggable:!1,closeOnEscape:!0,stack:!0,zIndex:9999999999,width:d?.9*o(window).width():"850",dialogClass:"usp__modalbox_wrapper",modal:!0,buttons:[{text:"Close",click:function(){o(this).dialog("close")}}]})}),_)},P_USP.closeDialogBox=function(){a.dialog("close")},o(P_USP.init)}(jQuery);
